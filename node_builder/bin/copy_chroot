#!/usr/bin/env bash
set -Eeuo pipefail
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

src_dir="$1"
dst_dir="$2"

"$DIR/unmount_chroot" "$1"

# https://unix.stackexchange.com/a/112325
rsync_args=(
#--verbose
--archive
--one-file-system
--xattrs
--hard-links
--numeric-ids
--sparse
--acls
#--exclude "$src_dir/var/log/*"
)

sudo rsync "${rsync_args[@]}" "${src_dir}/" "$dst_dir"

"$DIR/mount_chroot" "$dst_dir"
