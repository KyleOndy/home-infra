version: "3.7"
services:
  pixiecore:
    build: ./pixiecore
    network_mode: "host" # need to listen for dhcp
    volumes:
      - type: bind
        source: ./images
        target: /images
    #command: [ "boot", "--log-timestamps", "--debug",
    #           "/images/vmlinuz",
    #           "/images/initrd.gz",
    #           '--cmdline=auto-install/enable=true debconf/priority=critical netcfg/choose_interface=auto preseed/url={{ ID "/images/preseed.cfg" }}' ]
    command: [ "api", "http://{{MY_IP}}:9090/", "--debug", "--dhcp-no-bind" ]

  waitron:
    build: ./waitron
    volumes:
      - type: bind
        source: ./waitron
        target: /app
    ports:
      - 9090:9090
    working_dir: /app
    command: [ "--config", "/app/config.yaml", "--port", "9090" ]


